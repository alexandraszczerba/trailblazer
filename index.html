<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <title>Main Cesium Map</title>
  <style>
    #trailInfoDropdown {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 300px;
      z-index: 1000;
    }

    #trailInfoToggle {
      width: 100%;
      padding: 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #trailInfoContent {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 5px;
      margin-top: 5px;
    }

    #trailInfoContent h3 {
      margin: 0;
      font-size: 18px;
      font-weight: bold;
    }

    #trailPhotos img {
      width: 80px;
      height: 80px;
      border-radius: 5px;
    }

    #createTrailBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      padding: 10px 30px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #homeBtn {
      position: absolute;
      top: 50px;
      left: 10px;
      z-index: 1000;
      padding: 10px 30px;
      background-color: #28a745;
      color: white;
      text-decoration: none;
      font-size: 14px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <!-- Button to create a trail -->
  <a id="createTrailBtn" href="maketrail.html">Create Your Own Trail</a>

  <!-- Link to go back to the homepage -->
  <a id="homeBtn" href="homepage.html">Go to Home Page</a>

  <!-- Cesium container -->
  <div id="cesiumContainer" style="width: 100%; height: 100vh;"></div>

  <!-- Trail Info Dropdown -->
  <div id="trailInfoDropdown">
    <button id="trailInfoToggle">Trail Info</button>
    <div id="trailInfoContent">
      <h3 id="trailName"></h3>
      <p id="trailDetails"></p>
      <div id="trailPhotos" style="display: flex; gap: 10px;"></div>
    </div>
  </div>

  <script type="module">
    Cesium.Ion.defaultAccessToken = 'your-access-token-here';

    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrainProvider: Cesium.createWorldTerrain(),
      timeline: false,
      animation: false,
    });

    const trailInformation = {
      "Icehouse Canyon Trailhead": {
        difficulty: "8/10",
        distance: "8 miles",
        maxElevation: "9399 feet",
        photos: ["photo1.jpg", "photo2.jpg", "photo3.jpg"],
        notes: "Windy/Cold weather. Be cautious of ice and snow during winter.",
      },
      "Baldy Bowl Trailhead": {
        difficulty: "6/10",
        distance: "7 miles",
        maxElevation: "8600 feet",
        photos: ["baldy1.jpg", "baldy2.jpg"],
        notes: "Great trail for summer hikes.",
      },
      "Devil's Backbone Trailhead": {
        difficulty: "10/10",
        distance: "13.1 miles",
        maxElevation: "10200 feet",
        photos: ["backbone1.jpg", "backbone2.jpg"],
        notes: "Be super cautious when hiking. Steep drops with recent reports of casualties.",
      },
    };

    const trailheads = [
      {
        name: "Icehouse Canyon Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6397, 34.2501, 1500),
      },
      {
        name: "Baldy Bowl Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6476, 34.2889, 3050),
      },
      {
        name: "Devil's Backbone Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6432, 34.2880, 3050),
      },
      {
        name: "Manker Campground Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6259, 34.2663, 1900),
      },
    ];

    function addWaypoints(waypoints) {
      waypoints.forEach((waypoint) => {
        const entity = viewer.entities.add({
          name: waypoint.name,
          position: waypoint.position,
          point: {
            pixelSize: 10,
            color: Cesium.Color.BLUE,
            outlineColor: Cesium.Color.WHITE,
            outlineWidth: 2,
          },
          label: {
            text: waypoint.name,
            font: "14pt monospace",
            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
            outlineWidth: 2,
            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
            pixelOffset: new Cesium.Cartesian2(0, -10),
          },
        });

        entity.description = new Cesium.CallbackProperty(() => {
          const info = trailInformation[waypoint.name];
          if (!info) {
            console.error(`No trail information found for ${waypoint.name}`);
            return;
          }

          const trailInfoContent = document.getElementById("trailInfoContent");
          const trailName = document.getElementById("trailName");
          const trailDetails = document.getElementById("trailDetails");
          const trailPhotos = document.getElementById("trailPhotos");

          if (!trailInfoContent || !trailName || !trailDetails || !trailPhotos) {
            console.error("One or more trail info elements are missing from the DOM.");
            return;
          }

          // Update trail information UI
          trailInfoContent.style.display = "block";
          trailName.innerText = waypoint.name;
          trailDetails.innerHTML = `
            <strong>Difficulty:</strong> ${info.difficulty}<br>
            <strong>Distance:</strong> ${info.distance}<br>
            <strong>Max Elevation:</strong> ${info.maxElevation}<br>
            <strong>Notes:</strong> ${info.notes}
          `;

          // Clear and update photos
          trailPhotos.innerHTML = "";
          info.photos.forEach((photo) => {
            const img = document.createElement("img");
            img.src = photo;
            img.alt = waypoint.name;
            trailPhotos.appendChild(img);
          });
        });
      });
    }

    function initializeTrailInfoToggle() {
      const trailInfoToggle = document.getElementById("trailInfoToggle");
      const trailInfoContent = document.getElementById("trailInfoContent");

      trailInfoToggle.addEventListener("click", () => {
        if (trailInfoContent.style.display === "none") {
          trailInfoContent.style.display = "block";
        } else {
          trailInfoContent.style.display = "none";
        }
      });
    }

    addWaypoints(trailheads);
    initializeTrailInfoToggle();
  </script>
</body>
</html>
