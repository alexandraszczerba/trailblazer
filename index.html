<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Main Cesium Map</title>
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: Arial, sans-serif;
    }

    #cesiumContainer {
      width: 100%;
      height: 100%;
    }

    #trailInfoPanel {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 300px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 15px;
      border-radius: 5px;
      display: none;
      z-index: 1000;
    }

    #trailInfoPanel h3 {
      margin: 0 0 10px;
      font-size: 18px;
    }

    #trailDetails {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #trailDetails li {
      margin-bottom: 5px;
    }

    #createTrailBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 10;
      padding: 10px 20px;
      font-size: 16px;
      background-color: forestgreen;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #createTrailBtn:hover {
      background-color: darkgreen;
    }
  </style>
</head>
<body>
  <!-- Navigation to Homepage -->
  <nav>
    <a href="homepage.html">Go to Home Page</a>
  </nav>

  <!-- Cesium container for the map -->
  <div id="cesiumContainer"></div>

  <!-- Trail Info Panel -->
  <div id="trailInfoPanel">
    <h3 id="trailName">Trail Name</h3>
    <ul id="trailDetails">
      <!-- Dropdown content dynamically added here -->
    </ul>
  </div>

  <!-- Button for creating a trail -->
  <button id="createTrailBtn">Create Your Own Trail</button>

  <script type="module">
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiMzY5MGQwNy1kMzc1LTQwODItOTEyYS0zMzA0OWQ0OGE2NjUiLCJpZCI6MjU1NjMwLCJpYXQiOjE3MzE3MjI4MTF9.Kz18W1PwUWiwbUU72gEkqSNmGCcojyE12eDgpBM8U-8';

    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrain: Cesium.Terrain.fromWorldTerrain(),
    });

    // Define trails with metadata
    const trails = [
      {
        name: "Baldy Bowl Trail",
        elevation: "3050 ft",
        length: "4 miles",
        difficulty: "Hard",
        weather: "Clear, 55°F",
        path: [
          Cesium.Cartesian3.fromDegrees(-117.6476, 34.2889, 2100),
          Cesium.Cartesian3.fromDegrees(-117.6432, 34.2880, 2300),
          Cesium.Cartesian3.fromDegrees(-117.6390, 34.2891, 2400),
        ],
        color: Cesium.Color.RED,
      },
      {
        name: "Devil's Backbone to Mount Baldy Summit",
        elevation: "3068 ft",
        length: "3 miles",
        difficulty: "Moderate",
        weather: "Partly Cloudy, 50°F",
        path: [
          Cesium.Cartesian3.fromDegrees(-117.6432, 34.2880, 2300),
          Cesium.Cartesian3.fromDegrees(-117.6350, 34.2895, 3068),
        ],
        color: Cesium.Color.GREEN,
      },
    ];

    // Add trails to the map
    trails.forEach((trail) => {
      const entity = viewer.entities.add({
        name: trail.name,
        polyline: {
          positions: trail.path,
          width: 5,
          material: trail.color,
          clampToGround: true,
        },
        properties: {
          elevation: trail.elevation,
          length: trail.length,
          difficulty: trail.difficulty,
          weather: trail.weather,
        },
      });
    });

    // Display trail info on selection
    viewer.selectedEntityChanged.addEventListener((entity) => {
      if (entity) {
        const trailInfoPanel = document.getElementById("trailInfoPanel");
        trailInfoPanel.style.display = "block";

        document.getElementById("trailName").innerText = entity.name;
        document.getElementById("trailDetails").innerHTML = `
          <li>Elevation: ${entity.properties.elevation.getValue()}</li>
          <li>Length: ${entity.properties.length.getValue()}</li>
          <li>Difficulty: ${entity.properties.difficulty.getValue()}</li>
          <li>Weather: ${entity.properties.weather.getValue()}</li>
        `;
      } else {
        document.getElementById("trailInfoPanel").style.display = "none";
      }
    });

    // Add functionality to the "Create Your Own Trail" button
    document.getElementById('createTrailBtn').addEventListener('click', function () {
      createTrail();
    });

    let activeTrailPoints = [];
    let activePolyline = null;

    function createTrail() {
      if (activePolyline) {
        viewer.entities.remove(activePolyline);
        activeTrailPoints = [];
      }

      const handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);
      handler.setInputAction(function (click) {
        const earthPosition = viewer.camera.pickEllipsoid(
          click.position,
          viewer.scene.globe.ellipsoid
        );

        if (Cesium.defined(earthPosition)) {
          activeTrailPoints.push(earthPosition);

          if (activePolyline) {
            viewer.entities.remove(activePolyline);
          }

          activePolyline = viewer.entities.add({
            polyline: {
              positions: activeTrailPoints,
              width: 5,
              material: Cesium.Color.YELLOW,
            },
          });
        }
      }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

      handler.setInputAction(function () {
        handler.destroy();
      }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
    }
  </script>
</body>
</html>
