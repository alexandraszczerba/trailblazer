<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Main Cesium Map</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.123/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    #trailInfoDropdown {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 300px;
      z-index: 1000;
    }

    #trailInfoToggle {
      width: 100%;
      padding: 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #trailInfoContent {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 5px;
      margin-top: 5px;
    }

    #trailInfoContent img {
      width: 80px;
      height: 80px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <!-- Buttons -->
  <a id="createTrailBtn" href="maketrail.html">Create Your Own Trail</a>
  <a id="homeBtn" href="homepage.html">Go to Home Page</a>

  <!-- Cesium container -->
  <div id="cesiumContainer" style="width: 100%; height: 100vh;"></div>

  <!-- Trail Info Dropdown -->
  <div id="trailInfoDropdown">
    <button id="trailInfoToggle">Trail Info</button>
    <div id="trailInfoContent">
      <h3 id="trailName"></h3>
      <p id="trailDetails"></p>
      <div id="trailPhotos" style="display: flex; gap: 10px;"></div>
    </div>
  </div>

  <script type="module">
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiMzY5MGQwNy1kMzc1LTQwODItOTEyYS0zMzA0OWQ0OGE2NjUiLCJpZCI6MjU1NjMwLCJpYXQiOjE3MzE3MjI4MTF9.Kz18W1PwUWiwbUU72gEkqSNmGCcojyE12eDgpBM8U-8';

    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrainProvider: Cesium.createWorldTerrain(),
      timeline: false,
      animation: false
    });

    viewer.camera.flyTo({
      destination: Cesium.Cartesian3.fromDegrees(-117.64607, 34.0, 10500),
      orientation: {
        heading: Cesium.Math.toRadians(0.0),
        pitch: Cesium.Math.toRadians(-15.0),
      }
    });

    const trailInformation = {
      "Icehouse Canyon Trailhead": {
        difficulty: "8/10",
        distance: "8 miles",
        maxElevation: "9399 feet",
        photos: ["photo1.jpg", "photo2.jpg", "photo3.jpg"],
        notes: "Windy/Cold weather. Be cautious of ice and snow during winter."
      },
      "Baldy Bowl Trailhead": {
        difficulty: "6/10",
        distance: "7 miles",
        maxElevation: "8600 feet",
        photos: ["baldy1.jpg", "baldy2.jpg"],
        notes: "Great trail for summer hikes."
      },
      "Devil's Backbone Trailhead": {
        difficulty: "10/10",
        distance: "13.1 miles",
        maxElevation: "10200 feet",
        photos: ["backbone1.jpg", "backbone2.jpg"],
        notes: "Be super cautious when hiking. Steep drops with recent reports of casualties."
      }
    };

    const trailheads = [
      {
        name: "Icehouse Canyon Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6397, 34.2501, 1500)
      },
      {
        name: "Baldy Bowl Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6476, 34.2889, 3050)
      },
      {
        name: "Devil's Backbone Trailhead",
        position: Cesium.Cartesian3.fromDegrees(-117.6432, 34.2880, 3050)
      }
    ];

    trailheads.forEach(waypoint => {
      const entity = viewer.entities.add({
        name: waypoint.name,
        position: waypoint.position,
        point: {
          pixelSize: 10,
          color: Cesium.Color.BLUE,
          outlineColor: Cesium.Color.WHITE,
          outlineWidth: 2
        },
        label: {
          text: waypoint.name,
          font: '14pt monospace',
          style: Cesium.LabelStyle.FILL_AND_OUTLINE,
          outlineWidth: 2,
          verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
          pixelOffset: new Cesium.Cartesian2(0, -10)
        }
      });

      entity.description = new Cesium.CallbackProperty(() => {
        const info = trailInformation[waypoint.name];
        if (info) {
          document.getElementById("trailInfoContent").style.display = "block";
          document.getElementById("trailName").innerText = waypoint.name;
          document.getElementById("trailDetails").innerHTML = `
            <strong>Difficulty:</strong> ${info.difficulty}<br>
            <strong>Distance:</strong> ${info.distance}<br>
            <strong>Max Elevation:</strong> ${info.maxElevation}<br>
            <strong>Notes:</strong> ${info.notes}
          `;

          const photoContainer = document.getElementById("trailPhotos");
          photoContainer.innerHTML = "";
          info.photos.forEach(photo => {
            const img = document.createElement("img");
            img.src = photo;
            img.alt = waypoint.name;
            photoContainer.appendChild(img);
          });
        }
      });
    });

    // Hide trail info on map click
    viewer.scene.canvas.addEventListener("click", () => {
      document.getElementById("trailInfoContent").style.display = "none";
    });

    // Toggle trail info dropdown
    document.getElementById("trailInfoToggle").addEventListener("click", () => {
      const trailInfoContent = document.getElementById("trailInfoContent");
      trailInfoContent.style.display = trailInfoContent.style.display === "none" ? "block" : "none";
    });
  </script>
</body>
</html>
